<?xml version="1.0" encoding="utf-8" ?>

<project name="PHP-3" basedir="." default="symlink">


    <target name="vars">
        <echo msg="Setting local vars..."/>
        <resolvepath propertyName="tmp.dir" file="${project.basedir}" />
        <echo msg="Tmp dir is: ${tmp.dir}" />

        <php returnProperty="build.time" function="date">
            <param value="Y-m-d-H-i-s"/>
        </php>
        <!--<resolvepath propertyName="target.dir" file="c:\OpenServer\domains\php3.site" />-->
        <resolvepath propertyName="target.dir" file="c:\OpenServer\src-temp\php3.site\${build.time}" />

        <echo msg="target dir is: ${target.dir}" />

        <!--название домена который будет на продакшне-->
        <!--<resolvepath propertyName="domain_name" file="${project.basedir}" />-->
        <property name="domain_name" value="php3.site" />



    </target>




    <target name="copy" depends="vars">
        <mkdir dir="${target.dir}" />

        <copy todir="${target.dir}">
            <fileset dir="${tmp.dir}">
                <include name="**" />
                <!--<include name="public/**" />-->
                <exclude name="vendor/**" />
                <exclude name=".idea/**" />
            </fileset>
        </copy>
        <echo msg="Copy project" />

        <!--Create config-->
        <copy file="${project.basedir}/protected/config.php" todir="${target.dir}/protected/" overwrite="true">
            <filterchain>
                <replacetokens begintoken="{{" endtoken="}}">
                    <token key="domain" value="${domain_name}" />
                </replacetokens>
            </filterchain>
        </copy>
        <echo msg="Copy config with replace" />

    </target>

    <target name="composer" depends="copy">
        <echo msg="still composer do not use yet" />
        <!--<exec dir="${target.dir}" command="composer install" checkreturn="true" passthru="true"/>-->
    </target>
    <target name="symlink" depends="copy">
        <echo msg="symlink use or no?" />

        <!--Кажись потребуется только для винды, для моей.-->
        <!--<exec command="rd c:\OpenServer\domains\php3.site /q" />-->
        <exec command="rd c:\OpenServer\domains\${domain_name} /q" />

        <!--<symlink link="c:\OpenServer\domains\php3.site" target="c:\OpenServer\src-temp\php3.site\${build.time}" overwrite="true" />-->
        <symlink link="c:\OpenServer\domains\${domain_name}" target="c:\OpenServer\src-temp\php3.site\${build.time}" overwrite="true" />

    </target>

</project>